<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hutang — Dashboard</title>

<style>
/* ----------------------
   BASE / LAYOUT
   ---------------------- */
:root{
  --radius:12px;
  --gap:14px;
  --muted-alpha:0.7;
  --transition: .22s ease;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  transition:background var(--transition), color var(--transition);
  padding:20px;
  color:var(--text);
  background:var(--bg);
  min-height:100vh;
}

/* header */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:16px;
}
.title{
  display:flex;
  align-items:center;
  gap:12px;
}
.logo {
  width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;
  font-weight:700;color:var(--logo-text);background:var(--accent);flex-shrink:0;
  box-shadow:0 6px 18px rgba(0,0,0,0.15);
}
.headline {
  line-height:1;
}
.h1{font-size:18px;margin:0;font-weight:700;color:var(--text)}
.h2{font-size:12px;margin:0;color:var(--muted);font-weight:600}

/* controls */
.controls{display:flex;gap:12px;align-items:center}
.select-wrap{display:inline-flex;align-items:center;gap:8px}
select#themeSelector{
  -webkit-appearance:none;appearance:none;
  padding:8px 12px;border-radius:10px;border:1px solid var(--panel-border);
  background:var(--panel-bg);color:var(--text);font-weight:600;cursor:pointer;
  min-width:170px;
}

/* panel */
.panel{
  background:var(--panel-bg);
  border:1px solid var(--panel-border);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--panel-shadow);
}

/* summary cards */
.summary{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
.card{min-width:150px;padding:12px;border-radius:10px;background:var(--card-bg);border:1px solid var(--panel-border)}
.card h4{margin:0;font-size:12px;color:var(--muted)}
.card p{margin:8px 0 0;font-size:16px;font-weight:700;color:var(--text)}

/* table */
.table-wrap{overflow:auto;border-radius:10px}
table{width:100%;border-collapse:collapse;min-width:820px}
thead th{
  position:sticky;top:0;padding:12px 14px;text-align:left;font-size:13px;
  background:linear-gradient(180deg,var(--accent) 0%, color-mix(in srgb, var(--accent) 85%, transparent) 100%);
  color:var(--header-text);border-bottom:1px solid var(--table-border);
}
tbody td{padding:12px 14px;border-bottom:1px solid var(--row-border);background:var(--row-bg);color:var(--text)}
tbody tr:hover td{background:var(--row-hover)}
.pill{display:inline-block;padding:7px 10px;border-radius:999px;font-weight:700;font-size:12px}
.pill.lunas{background:color-mix(in srgb, #16a34a 12%, transparent);color:var(--ok);border:1px solid rgba(22,163,74,0.12)}
.pill.belum{background:color-mix(in srgb, #f59e0b 12%, transparent);color:var(--warn);border:1px solid rgba(245,158,11,0.12)}

/* helper */
.empty{text-align:center;padding:30px;color:var(--muted)}

/* responsive */
@media (max-width:900px){thead th{font-size:12px}table{min-width:700px}}

/* ----------------------------
   THEME VARIABLES (CONSISTENT)
   ---------------------------- */

/* DEFAULT / DARK */
.theme-midnight,
.theme-gelap,
.theme-lautan {
  --bg:#0a1521;
  --text:#e6f0ff;
  --muted:rgba(230,240,255,0.75);
  --accent:#2296ee;
  --panel-bg:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));
  --panel-border:rgba(255,255,255,0.03);
  --panel-shadow:0 8px 28px rgba(2,6,23,0.55);
  --card-bg:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));
  --row-bg:transparent;
  --row-hover:rgba(255,255,255,0.02);
  --row-border:rgba(255,255,255,0.03);
  --table-border:rgba(255,255,255,0.04);
  --header-text:#fff;
  --ok:#16a34a;
  --warn:#f59e0b;
  --logo-text:#042225;
}

/* LAUTAN FIX */
.theme-lautan{
  --bg:#0f1720;
  --text:#cfeeff;
  --muted:rgba(160,220,255,0.7);
  --accent:#22d3ee;
  --panel-bg:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));
  --logo-text:#04202b;
}

/* TERANG */
.theme-terang{
  --bg:#f6f8fb;
  --text:#0b1220;
  --muted:#5b6b75;
  --accent:#1a73e8;
  --panel-bg:#ffffff;
  --panel-border:#e6eef9;
  --panel-shadow:0 6px 18px rgba(19,38,77,0.06);
  --card-bg:#fff;
  --row-bg:#fff;
  --row-hover:#f4f8ff;
  --row-border:#eef3fb;
  --table-border:#e6eef9;
  --header-text:#fff;
  --ok:#057a31;
  --warn:#b45309;
  --logo-text:#ffffff;
}

/* SEPIA */
.theme-sepia{
  --bg:#f3ead6;--text:#4a3523;--muted:#6e5850;--accent:#b48a54;
  --panel-bg:#fff7ec;--panel-border:#e9dbbf;--panel-shadow:0 6px 18px rgba(0,0,0,0.04);
  --card-bg:#fff7ec;--row-hover:#fff2e6;--row-border:#eadfc3;--logo-text:#5a3a20;
}

/* HUTAN */
.theme-hutan{
  --bg:#071812;--text:#dffbe8;--muted:#bfeedd;--accent:#1fb276;
  --panel-bg:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));
  --panel-border:rgba(150,210,180,0.06);--logo-text:#042c1a;
}

/* PANTAI */
.theme-pantai{
  --bg:#fff7e8;--text:#3b2b11;--muted:#6b5433;--accent:#e89b1a;
  --panel-bg:#fffdf6;--panel-border:#f3dcc0;--logo-text:#5b3b11;
}

/* SUNSET */
.theme-sunset{
  --bg:#201019;--text:#ffdfe8;--muted:#f2cacf;--accent:#ff6b6b;--logo-text:#3b0a0a;
}

/* RETRO */
.theme-retro{
  --bg:#fbf5dc;--text:#3d2f0e;--muted:#8b6f3e;--accent:#d88f32;--logo-text:#3d2f0e;
}

/* PERMEN */
.theme-permen{
  --bg:#fff0f8;--text:#5a1440;--muted:#8c3b6e;--accent:#ff4ecf;--logo-text:#5a1440;
}

/* DARAH */
.theme-darah{
  --bg:#2b0606;--text:#ffdede;--muted:#f3bdbd;--accent:#a30000;--logo-text:#3b0000;
}

/* MIDNIGHT */
.theme-midnight{
  --bg:#0b0f1a;--text:#dbe9ff;--muted:#9fb7ff;--accent:#5b72ff;--logo-text:#08122a;
}

/* default fallbacks */
:root{--panel-shadow:0 8px 30px rgba(2,6,23,0.4); --panel-border:rgba(255,255,255,0.04); --logo-text:#fff}

/* FIX: paksa dropdown option netral agar tidak kena tema */
select option {
  background:#fff !important;
  color:#000 !important;
}

/* small utility */
.hidden{display:none}
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="title">
    <div class="logo" id="logo" aria-hidden="true">UT</div>
    <div class="headline">
      <div class="h1">Hutang — Dashboard</div>
    </div>
  </div>

  <div class="controls">
    <div style="text-align:right">
      <div style="font-size:12px;color:var(--muted);font-weight:700;margin-bottom:6px">Pilih Tema:</div>
      <div class="select-wrap">
        <select id="themeSelector" aria-label="Pilih Tema">
          <option value="terang">Terang</option>
          <option value="gelap">Gelap</option>
          <option value="lautan">Lautan</option>
          <option value="midnight">Midnight</option>
          <option value="hutan">Hutan</option>
          <option value="pantai">Pantai</option>
          <option value="sunset">Sunset</option>
          <option value="sepia">Sepia</option>
          <option value="retro">Retro</option>
          <option value="permen">Permen</option>
          <option value="darah">Darah</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- PANEL -->
<div class="panel">
  <div class="summary" id="summaryRow">
    <div class="card">
      <h4>Total Hutang</h4>
      <p id="totalHutang">Rp 0</p>
    </div>
    <div class="card">
      <h4>Total Piutang</h4>
      <p id="totalPiutang">Rp 0</p>
    </div>
    <div class="card">
      <h4>Belum Lunas</h4>
      <p id="countBelum">0</p>
    </div>
    <div class="card">
      <h4>Lunas</h4>
      <p id="countLunas">0</p>
    </div>
  </div>

  <div class="table-wrap" style="margin-top:6px">
    <table id="dataTable" aria-label="Daftar Hutang Piutang">
      <thead>
        <tr>
          <th>Nama</th>
          <th>Type</th>
          <th style="text-align:right">Nominal</th>
          <th>Tanggal</th>
          <th>Keterangan</th>
          <th style="text-align:right">Sisa Hutang</th>
          <th style="width:120px">Status</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td class="empty" colspan="7">Memuat data...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const SHEET_ID = "1MQPeUwTCtkZ1GDUtO920c2XivHAkZ2BMFUJroUNlMCM";
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

/* THEME logic */
const themeSelector = document.getElementById('themeSelector');
function applyTheme(name){
  document.body.className = '';
  const cls = (name === 'default') ? 'theme-default' : `theme-${name}`;
  document.body.classList.add(cls);
  const logo = document.getElementById('logo');
  try {
    const accent = getComputedStyle(document.body).getPropertyValue('--accent');
    logo.style.background = accent.trim();
    logo.style.color = getComputedStyle(document.body).getPropertyValue('--logo-text');
  } catch(e){}
}
themeSelector.addEventListener('change', (e)=>{
  const v = e.target.value;
  applyTheme(v);
  localStorage.setItem('hutang_theme', v);
});
(function(){
  const saved = localStorage.getItem('hutang_theme') || 'terang';
  themeSelector.value = saved;
  applyTheme(saved);
})();

/* utilities */
function fmtNumber(n){
  if (n === '' || n === null || n === undefined) return '0';
  const num = Number(n) || 0;
  return num.toLocaleString('id-ID');
}
function fmtCurrency(n){ return 'Rp ' + fmtNumber(n); }
function fmtDate(d){
  if (!d) return '-';
  const parsed = new Date(d);
  if (parsed.toString() === 'Invalid Date') return d;
  return parsed.toLocaleDateString('id-ID',{day:'2-digit',month:'short',year:'numeric'});
}
function escapeHtml(s){
  if (s===null||s===undefined) return '';
  return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]));
}

/* parse gviz JSON */
function parseGviz(text){
  const start = text.indexOf('{');
  const json = JSON.parse(text.substring(start));
  return json.table.rows || [];
}

/* render */
const tbody = document.getElementById('tbody');
const totalHutangEl = document.getElementById('totalHutang');
const totalPiutangEl = document.getElementById('totalPiutang');
const countBelumEl = document.getElementById('countBelum');
const countLunasEl = document.getElementById('countLunas');

function renderEmpty(msg){
  tbody.innerHTML = `<tr><td class="empty" colspan="7">${msg}</td></tr>`;
}

function loadAndRender(){
  renderEmpty('Memuat data dari Google Sheet...');
  fetch(SHEET_URL).then(r=>r.text()).then(text=>{
    const rows = parseGviz(text);
    if (!rows.length) return renderEmpty('Sheet kosong atau tidak bisa diambil.');
    tbody.innerHTML = '';
    let totalHutang=0, totalPiutang=0, countBelum=0, countLunas=0;

    rows.forEach(r=>{
      const c = (r.c||[]).map(x=>x ? x.v : '');
      const nama = c[1] ?? '';
      const tipe = (c[2] ?? '') + '';
      const nominal = Number(c[3] || 0);
      const tanggal = c[4] ?? '';
      const catatan = c[5] ?? '';
      const sisa = (c[6]==='' || c[6]===null || c[6]===undefined) ? 0 : Number(c[6]);
      const statusRaw = (c[7] ?? '') + '';
      const status = statusRaw.toLowerCase().includes('lunas') ? 'Lunas'
                   : statusRaw.toLowerCase().includes('belum') ? 'Belum Lunas'
                   : statusRaw || 'Belum Lunas';

      if (tipe.toLowerCase().includes('hutang')) totalHutang += nominal;
      if (tipe.toLowerCase().includes('piutang')) totalPiutang += nominal;
      if (status.toLowerCase().includes('lunas')) countLunas++; 
      else countBelum++;

      const statusClass = status.toLowerCase().includes('lunas') ? 'lunas' : 'belum';

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(nama)}</td>
        <td style="min-width:100px">${escapeHtml(tipe)}</td>
        <td style="text-align:right">${fmtCurrency(nominal)}</td>
        <td>${fmtDate(tanggal)}</td>
        <td>${escapeHtml(catatan)}</td>
        <td style="text-align:right">${fmtCurrency(sisa)}</td>
        <td><span class="pill ${statusClass}">${escapeHtml(status)}</span></td>
      `;
      tbody.appendChild(tr);
    });

    totalHutangEl.textContent = fmtCurrency(totalHutang);
    totalPiutangEl.textContent = fmtCurrency(totalPiutang);
    countBelumEl.textContent = countBelum;
    countLunasEl.textContent = countLunas;

  }).catch(err=>{
    console.error(err);
    renderEmpty('Gagal mengambil data — pastikan Google Sheet sudah di-publish.');
  });
}

loadAndRender();
setInterval(loadAndRender, 90000);
</script>

</body>
</html>
